---
title: "F17-eDV-Final-Project: InstaCart and Nutritional Data"
author: "Group 10: Nikhil Bhargava, Anna Kong, Daniel Yang"
resource_files:
- .Renviron
output:
  html_document:
    code_folding: show
    toc: yes
    toc_depth: 4
    toc_float: yes
runtime: shiny
---

```{r setup, include=FALSE}
library(tidyverse)
require(data.world)
require(dplyr)
knitr::opts_chunk$set(echo = TRUE)
```

## **R Session Info**  

```{r}
sessionInfo()
```

```{r}
#Connecting to data.world
project <- "https://data.world/nikhilbhargava/f-17-edv-project-5"
data.world::set_config(cfg_env("DW_API"))
```

## Link to Data.World project
###[Project 5 Group 10 Data.world Link](https://data.world/nikhilbhargava/f-17-edv-project-5 "F17 eDV Final Project Data.world")

_________________________

## **Cleaning Our Initial Data Set**

###Starting with "Dirty" Data

We began in Project 5 by downloading a data set from instacart and nutritional fact data. Initially, the data was riddled with special characters, blank spaces, and unfriendly formatting. 

Below is the code for the data input from the CSV file.
```{r}
dfDirty <- (read_csv("f-17-edv-project-5-final.csv", col_types = cols(
  `calcium` = col_number(),
  `calories` = col_number(),
  `Caloriesfrom_Fat` = col_number(),
  `chole-sterol_1` = col_number(),
  `chole-sterol` = col_number(),
  `dietary_fiber_1` = col_number(),
  `dietary_fiber` = col_number(),
  `food_type` = col_character(),
  `food_and_serving` = col_character(),
  `number_of_records` = col_number(),
  `potassium_1` = col_number(),
  `potassium` = col_number(),
  `protein` = col_number(),
  `saturated_fat_1` = col_character(),
  `saturated_fat` = col_character(),
  `serving_size` = col_character(),
  `sodium_1` = col_number(),
  `sodium` = col_number(),
  `sugars` = col_number(),
  `total_carbo_hydrate_1` = col_number(),
  `total_carbo_hydrate` = col_number(),
  `total_fat_1` = col_number(),
  `total_fat` = col_number(),
  `vitamin_a` = col_number(),
  `vitamin_c` = col_number(),
  `add_to_cart_order` = col_number(),
  `aisle` = col_character(),
  `aisle_id_aisles_csv` = col_number(),
  `aisle_id` = col_number(),
  `days_since_prior_order` = col_number(),
  `department` = col_character(),
  `department_id_departments_csv` = col_number(),
  `department_id` = col_number(),
  `eval_set` = col_character(),
  `order_dow` = col_number(),
  `order_hour_of_day` = col_number(),
  `order_id_orders_reduced_csv` = col_number(),
  `order_id` = col_number(),
  `order_number` = col_number(),
  `product_id_order_products_train_reduced_csv` = col_number(),
  `product_id` = col_number(),
  `product_name` = col_character(),
  `reordered` = col_logical(),
  `user_id` = col_number(),
  `iron` = col_number()
)))
```


###Cleaning the dataset: R code, replacing special characters

```{r}
for(n in names(dfDirty)){
  dfDirty[n] <- lapply(dfDirty[n], gsub, pattern="[^ -~]",replacement = "")
}
```

### Exporting the cleaned CSV
```{r}
dfClean <- dfDirty
write_csv(dfClean, "cleanFinalData.csv")
```

_________________________


## **Daniel Yang's Insights**

###Most popular Products
#### [Insight Link: Most popular prodcuts](https://data.world/nikhilbhargava/f-17-edv-project-5/insights/d32e288e-b194-458f-9bfa-2c2fb80a049a)
<iframe align = "center" width = "1000" height = "1000" src="https://public.tableau.com/profile/daniel.yang#!/vizhome/InstaCartDVFinalProject/Mostpopularproductsalltime?publish=yes"/>

###Distinct users throughout the day
#### [Insight Link: Distinct users throughout a day and from department was ordered](https://data.world/nikhilbhargava/f-17-edv-project-5/insights/b6fb6098-271b-4701-855c-408a2cd355c7)
<iframe align = "center" width = "1000" height = "1000" src="https://public.tableau.com/profile/daniel.yang#!/vizhome/InstaCartDVFinalProject/Distinctusersthroughtheday?publish=yes"/>

###Number of Products for each Department and Aisle
#### [Insight Link: Number of Products for each Department and Aisle](https://data.world/nikhilbhargava/f-17-edv-project-5/insights/7ba96095-d29f-41a1-ad07-e7b5687cc01f)
<iframe align = "center" width = "1000" height = "1000" src="https://public.tableau.com/profile/daniel.yang#!/vizhome/InstaCartDVFinalProject/ofproductsforeachdeptandaisle?publish=yes"/>

###Sugar vs Total Carbs
#### [Insight Link: Sugar vs. Total Carbohydrates](https://data.world/nikhilbhargava/f-17-edv-project-5/insights/d7d0ba68-8c58-4744-87f8-3f1fe538bf35)
<iframe align = "center" width = "1000" height = "1000" src="https://public.tableau.com/profile/daniel.yang#!/vizhome/InstaCartDVFinalProject/CorrelationTotalCarbsandSugars?publish=yes"/>

## **Anna Kong's Insights**

### **Cleaning our Nutitional Data** 

#### [Insight Link: Cleaning Nutritional Data](https://data.world/nikhilbhargava/f-17-edv-project-5/insights/f4c8ed41-a443-4d43-889a-d41a3d6114b4)


The Nutritional Data we found had some issues with its column names and text format, so we had to do some cleaning before working with it.

![Screenshot of Unclean Nutritional Data Set](uncleanNutritionDataExample.png)

Below is the code for the data input from the CSV file. (Click on "Code" to show details)

```{r}
dfDirty <- (read_csv("uncleanNutritionData.csv", col_types = list(
  `food_and_serving` = col_character(),
  `calories`= col_number(),
  `caloriesaefrom_fat` = col_number(),
  `total_fat_g` = col_number(),
  `total_fat_dv` = col_number(),
  `sodium_g` = col_number(),
  `sodium_dv` = col_number(),
  `potassium_g` = col_number(),
  `potassium_dv` = col_number(),
  `total_carbo_hydrate_g` = col_number(),
  `total_carbo_hydrate_dv` = col_number(),
  `dietary_fiber_g` = col_number(),
  `dietary_fiber_dv` = col_number(),
  `sugars_g` = col_number(),
  `protein_g` = col_number(),
  `vitamin_a_dv` = col_number(),
  `vitamin_c_dv` = col_number(),
  `calcium_dv` = col_number(),
  `aeaeironaeae_dv` = col_number(),
  `saturated_fat_dv` = col_number(),
  `saturated_fat_mg_ae` = col_number(),
  `chole_sterol_dv` = col_number(),
  `chole_sterol_mg_ae` = col_number(),
  `serving_size` = col_character(),
  `food_type` = col_character()
)))
```

We clean up the dataset's column names.

```{r}
# Cleaning up special characters
for(n in names(dfDirty)) {
  dfDirty[n] <- data.frame(lapply(dfDirty[n], gsub, pattern="[^ -~Ã]", replacement= ""))
  dfDirty[n] <- data.frame(lapply(dfDirty[n], gsub, pattern="ServingSize", replacement= "Serving Size"))
  dfDirty[n] <- data.frame(lapply(dfDirty[n], gsub, pattern="eweight", replacement= "e weight"))
  dfDirty[n] <- data.frame(lapply(dfDirty[n], gsub, pattern="mweight", replacement= "m weight"))
}


# Cleaning up column names
colnames(dfDirty) <- gsub(pattern = "sae", replacement = "s_", colnames(dfDirty))
colnames(dfDirty) <- gsub(pattern = "_?ae", replacement = "", colnames(dfDirty))  
colnames(dfDirty) <- gsub(pattern = "carbo_hydrate", replacement = "carbohydrate", colnames(dfDirty))
colnames(dfDirty) <- gsub(pattern = "chole_sterol", replacement = "cholesterol", colnames(dfDirty))
```

Finally, we export the new dataset as a csv, to be uploaded to Data.world

```{r}
dfClean <- dfDirty
write_csv(dfClean, "cleanNutritionData.csv")
```

![Screenshot of Clean Nutritional Data Set](cleanNutritionDataExample.png)

 
______________________________________
 
## **Nikhil Bhargava's Insights**

______________________________________

## **Interesting Findings/Summary**

______________________________________

## **Appendix: Concepts Covered**